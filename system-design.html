<!-- build time:Thu Aug 08 2019 21:53:10 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script></script><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="yandex-verification" content="be23233c5033cd4a"><meta name="baidu-site-verification" content="KFXVdNKQ18"><meta name="360-site-verification" content="bbd6f1a0727d8ef429be7131a051be20"><meta name="shenma-site-verification" content="719fb1b0c8f713194c5ac0387ee88673_1519303685"><meta name="msvalidate.01" content="EA3043B3BEC4629344CE5A71597718A0"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="1075199251,Âº†ÂáØ,18772383543,wuwii,ËøΩÂÖâËÄÖw,ÊúâÊ¢¶ÊÉ≥ÁöÑÂí∏È±º,‰∏ÄÊ£µÊ†ëÁ´ôÂú®ÂéüÈáé‰∏ä,Slience"><link rel="alternate" href="/atom.xml" title="My Sunshine" type="application/atom+xml"><meta name="description" content="This document is to document the learning process for System Design.A few concepts to research:How to split data between servers? How do multiple server communicate? MapReduce?How does server process"><meta name="keywords" content="1075199251,Âº†ÂáØ,18772383543,wuwii,ËøΩÂÖâËÄÖw,ÊúâÊ¢¶ÊÉ≥ÁöÑÂí∏È±º,‰∏ÄÊ£µÊ†ëÁ´ôÂú®ÂéüÈáé‰∏ä,Slience"><meta property="og:type" content="article"><meta property="og:title" content="System Design"><meta property="og:url" content="http://blog.wuwii.com/system-design.html"><meta property="og:site_name" content="My Sunshine"><meta property="og:description" content="This document is to document the learning process for System Design.A few concepts to research:How to split data between servers? How do multiple server communicate? MapReduce?How does server process"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2018-06-18T13:25:59.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="System Design"><meta name="twitter:description" content="This document is to document the learning process for System Design.A few concepts to research:How to split data between servers? How do multiple server communicate? MapReduce?How does server process"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"Âçö‰∏ª"},algolia:{applicationID:"TWXZ15WRBL",apiKey:"c272bd4b810c8b43773a3f1d3c6b8d27",indexName:"wuwii",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://blog.wuwii.com/system-design.html"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#1f94aa"><title>System Design | My Sunshine</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?b847762b9271725a63131e554978de0a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript">!function(){var e=document.createElement("script");e.src="//tajs.qq.com/stats?sId=63798915";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link href="https://zqnight.gitee.io/kaimz.github.io/css/harlem-shake-style.css" rel="stylesheet" type="text/css"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><div class="forkme"><a rel="external nofollow noopener noreferrer" href="https://github.com/kaimz" target="_blank"><img style="position:absolute;top:0;left:0;border:0" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub"></a></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">My Sunshine</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">È∏£Ë∞¢ÁîüÂëΩÊúâ‰Ω†ÂèÇ‰∏é Á¨ëÁ∫≥ÊàëÁöÑÈÇÄËØ∑„ÄÇ</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>È¶ñÈ°µ</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>ÂàÜÁ±ª</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>ÂÖ≥‰∫é</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>ÂΩíÊ°£</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Ê†áÁ≠æ</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>ÊêúÁ¥¢</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="ÊêúÁ¥¢..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav><canvas id="wobblew" width="1056" height="150" style="position:absolute;z-index:-1;left:0;top:0"></canvas></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.wuwii.com/system-design.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="KronChan"><meta itemprop="description" content=""><meta itemprop="image" content="https://i.loli.net/2017/12/28/5a45010eded15.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="My Sunshine"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">System Design</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">ÂèëË°®‰∫é</span> <time title="ÂàõÂª∫‰∫é" itemprop="dateCreated datePublished" datetime="2017-12-22T10:08:03+08:00">2017-12-22 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">ÂàÜÁ±ª‰∫é</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Â≠¶‰π†Á¨îËÆ∞/" itemprop="url" rel="index"><span itemprop="name">Â≠¶‰π†Á¨îËÆ∞</span></a></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">Â≠óÊï∞ÁªüËÆ°</span> <span title="Â≠óÊï∞ÁªüËÆ°">2,368 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">ÈòÖËØªÊó∂Èïø</span> <span title="ÈòÖËØªÊó∂Èïø">15</span></div></div></header><div class="post-body" itemprop="articleBody"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>This document is to document the learning process for <strong>System Design</strong>.<br>A few concepts to research:<br>How to split data between servers? How do multiple server communicate? MapReduce?<br>How does server process heavy calculation in background? Threading? NodeJS threading?</p><a id="more"></a><h2 id="Good-Concepts"><a href="#Good-Concepts" class="headerlink" title="Good Concepts:"></a>Good Concepts:</h2><ul><li>For any system, consider: how much data does the system handle? how much data does the system need to store?</li><li>Popular hashing algorithm: like 35. What about md5?</li><li>Scalibility</li></ul><h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps:"></a>Steps:</h2><ol><li><strong>Scope</strong> the problem: Don‚Äôt make assumptions; Ask questions; Understand the constraints and use cases.</li><li>Sketch up an <strong>abstract design</strong> that illustrates the basic components of the system and the relationships between them.</li><li>Think about the <strong>bottlenecks</strong> these components face when the system scales.</li><li>Address these bottlenecks by using the fundamentals principles of <strong>scalable</strong> system design.</li></ol><ul><li>Mine Usual steps: might be too much details on scoping but less efforts onto bottlenecks and scalibility issues.</li></ul><ol><li>Identify the key requirements &amp;&amp; constraints</li><li>Identify the users &amp;&amp; Server</li><li>Identify inputs/ouputs from different users<br>*** Calculate the bandwidth and storage: the amount of data the server handles, and the amount of data server stores.</li><li>Based on (1~3), list out the potential features that needs to be implemented</li><li>Pick technologies that will be able to implement the features above:<ul><li>backend server</li><li>user client</li><li>method of storage</li><li>method of data trasmissio</li></ul></li><li>How does the system scale? What are the limits and trade-off in current design? What improvmenet can be done to design it differently?</li></ol><h2 id="Scalibility-lecture"><a href="#Scalibility-lecture" class="headerlink" title="Scalibility lecture"></a>Scalibility lecture</h2><ul><li><p>key concepts:<br>Vertical scaling: add more cpu,ram,hard-drive<br>Horizontal scaling:add more cheaper computer, distribute traffice &amp;&amp; storage into these machiens.<br>Caching: save some pre-processed data, like sticky session, pre-quried sqls<br>Load balancing: determine which web server to hit; determine which db to hit if having multiple db<br>Database replication: for faster read; for reduancy safety<br>Database partitioning: for faster performance for some contents, or distributed storage<br>Using NoSQL instead of scaling a relational database<br>Being asynchronous</p></li><li><p>Load Balancer?<br>load balancer is even good to protect server: now backend server can be on LAN with load balancer, so they are protected; and we just expose load balancer to clients.<br>How does load balancer work?<br>There are lots of trade-offs: look at 30:00 of the video. That‚Äôs all the tradeoffs (<a href="http://www.hiredintech.com/system-design/scalability-fundamentals/" rel="external nofollow noopener noreferrer" target="_blank">http://www.hiredintech.com/system-design/scalability-fundamentals/</a>)</p><pre><code>- round robin: the load balancer works as a fancy DNS machine, take turns to assign task/request to machine 1,2,3,4...etc. (if we do `nsloopup google.com` on google.com, we can see google does that)
- store states/sessions into a dedicated server. but it indroduces server-failure issue. -use RAID, raplication
    RAID0: strip data at two hardrives, little on each
    RAID1: mirror data. store at both places
    RAID10: combination of RAID0 &amp;&amp; RAID1.
    RAID5: 3 drives only 1 of them is used for reduendency.
    RAID6: multiple drives. any drive can die, then replace, and no data lost.
- split by the type of files request: html server, image server; load balancer
- split based on actual load (less possible), send package to less busy server
</code></pre><p>Options:<br>Software:</p><pre><code>ELB: elastic load balancer
HAProxy
LVS 
</code></pre><p>hardware:</p><pre><code>Barracuda
Cisco
Citrix: over-priced, $20k 
F5
</code></pre><p>Problem: sticky session (if you revisit the site multiple times seprately, you will still hit the same server)</p><pre><code>- can store serverID in the cookie (one downside: safety, showed the whole world about server IP). So again, can store a random number/hashed value on Load Balancer. It shows which serverID to hit once revisiting. Remember which back-end server to send cookie to.
</code></pre></li><li><p>Caching:<br>file-based caching approach: send .html out.</p><pre><code>down-side: 1. space. 2. old generated files are really hard to change.
</code></pre><p>mysqul-query cashed: for identical sql request<br>memcached: store in memory of the idetical query. Like a table. store &lt;key, value&gt;.</p><pre><code>next time when checking, try look up key.
Down-side: run out of ram. Solution: LRUCahe, remove old records(double-linked-list)
</code></pre></li><li><p>Replication:<br>Master &amp;&amp; multiple Slaves</p><pre><code>advantage: 1. Same request/query will be paste to all slaves, so master fail, just put up one salve; 2. If READ heavy, they are redundant server to lots readings.
disadvantage:
</code></pre><p>Must have at least load balancer: that is one-point-failure if just one load balancer</p></li><li><p>Partitioning:<br>based on user informaiton, like name. Put common user (same last name) into certain servers.</p></li><li><p>Bottleneck: data traffice and data storage</p></li><li>‚Äî‚ÄîExample</li><li>1:26:00 of the video (<a href="http://www.hiredintech.com/system-design/scalability-fundamentals/" rel="external nofollow noopener noreferrer" target="_blank">http://www.hiredintech.com/system-design/scalability-fundamentals/</a>)<br>We have backend web server<br>Sticky session: use cookie and store server ID<br>Use load balancer that two web server connects:<br>Use load balancer to link to the two master db:<br>Two master db that talks to each other: master-master replication<br>Now we need 2 load balancer to prevent one-point-failure at the webServer-db connection.<br>Now we also need 2 load balancers at the (which web server to hit) level, that is another 1-pointer-failure<br>Switch for the complex connections:<br>Now we have so many connections: we need switches to handle the connections.<br>We need at least two ports on each device to: go to the correct switch. Becareful with loop.</li><li><p>Eventually we will handle: (1:34:00)<br>Scalibility<br>Redundancy<br>High probablity of up time<br>Resolution against failure</p></li><li><p>Another big issue:<br>What is ISP goes down? The whole package mentioned above go down?</p><pre><code>Amazon solution, another ISP, called avalibility zone: like west, asia, south american.
How to distribute IP on different data center? Load Balancer at the DNS level, global Load Balancer.  (Note, if in one building, could be staying at this building)
    Well, if a building is gone, once your TTL(Time to live) is expired, you will be re-route to another ISP building.
</code></pre></li><li><p>Before getting into building:<br>Firewall, only a few ports are open: like tcp80, 443, 22 (ssh)<br>can allow https before first load balancer inside building, and decrypt it after first load balancer<br>at db lever, only 3306 is allowed.<br>Reason to lock, for example, 3306 not allowed at entering building? Because no one needs to inject query to db from outside of building; sql query usually only need to be done within the building, so lock the building up, don‚Äôt allow bad sql injection : )</p></li></ul><h3 id="URL-convention-Example-Final-http-www-hiredintech-com-system-design-final-thoughts"><a href="#URL-convention-Example-Final-http-www-hiredintech-com-system-design-final-thoughts" class="headerlink" title="URL convention Example Final (http://www.hiredintech.com/system-design/final-thoughts/)"></a>URL convention Example Final (<a href="http://www.hiredintech.com/system-design/final-thoughts/" rel="external nofollow noopener noreferrer" target="_blank">http://www.hiredintech.com/system-design/final-thoughts/</a>)</h3><ul><li><p>simple rules:<br>Always start a single machine<br>Benchmark the bottle necks, where it indroduces complexity. (No need to add extra complexity)<br>Think about the questions like: why sql vs. non-sql?</p></li><li><p>Scalable design:</p><ol><li><p>Application, web server, handle requests/traffic</p><ul><li>start with 1 server</li><li>it‚Äôs better to measure the spark traffic (highest we get)</li><li>add load balancer, and a cluster of servers. (could use amazon elastic load balancer, to automatically add more servers)</li></ul></li><li><p>Data Storage<br>1) Billions of object, 2) each object is small, 3) no relationship between object, 4) read 9x more than write (360read/s, 40writes/s), 5) 3TB urls, 36GB of hashes<br>We can use sql or non-sql<br>In example, go with MySQL</p><pre><code>widely used
Mature tech
Clear scaling paradiams(sharding, master/slave replication, master/master replication)
Used by fb, twitter, google.
* index lookups are very fast (as fast as non-sql)
</code></pre><p>mappings:</p><pre><code>hash: varchar(6)
original_url: varchar(512)
</code></pre><p>Over years, it holds 3TB data. Storage-wise, it‚Äôs okay. However, how to serve up quickly?</p><ul><li>First, Use one MySQL table with two varchar fields</li><li>Create uinique index on the hash(36GB+). We want to hold it in memory. However, we need to look up fast.</li><li>For 1st stemp, vertical scaling of the MySQL machine, adding more RAM (nowadays ram are cheaper too : )</li><li>Eventually need to partition the data, into 5 partitions: 600GB of data, 8GB of indexes on each machine. (Partitioning early on, it helps to scale later, just add more nodes)</li><li>One day, if read/write are super different, Master-Slave, ‚Ä¶<br>write to master, and read from slaves.</li></ul></li></ol></li></ul><h2 id="Design-UBER"><a href="#Design-UBER" class="headerlink" title="Design UBER"></a>Design UBER</h2><ol><li><p>Requirements<br>Same requirements between user &amp;&amp; driver: GPS tracking, detect pickup/drop off, cost calculation<br>Design a web app (or mobile app) for end user to make/cancel car reservation, make payment, rate driver.<br>Design a web app (or mobile app) for driver to accept/decline car reservation, accept payment, rate passenger.<br>Extra features beyond basics: car pool, split cost, rush-hour rate calculation.</p></li><li><p>Identify the end systems:<br>Backend server that handles communication, data tracking, payment trasaction‚Ä¶etc<br>Passenger user app<br>Driver user app</p></li><li><p>Inputs and outputs of each end system:<br><strong>Server should store every piece of information received or change to database during this process</strong><br>Server-input:</p><ul><li>Passenger create account, login, log off</li><li>Driver create account, login, log off</li><li>Passenger/Driver payment information</li><li>driver locations</li><li>passenger locations</li><li>GPS location data before &amp;&amp; during the trip</li><li>request to pair driver &amp;&amp; passenger</li><li>request to start trip</li><li>request to end trip</li><li>request to drop reservation from driver</li><li>request to drop reservation from passenger</li><li>request to calculate cost per trip</li><li>accept rating, comment, report ‚Ä¶</li></ul><p>Server-output:</p><pre><code>* ack passenger account generation, login, logoff
* ack driver account generation, login, logoff
* ack driver/passenger payment info and store to db
</code></pre><ul><li>broadcast driver locations to passenger</li><li>broadcast passenger locations to driver</li><li>response pair confirmation to driver &amp;&amp; passenger with contact information of driver&amp;&amp;passenger</li><li>start a trip between driver &amp;&amp; passenger</li><li>end a trip between driver &amp;&amp; passenger</li><li>calculate recommended route and send to driver&amp;&amp;passenger</li><li>response reservation dropped from driver with panelty</li><li>response reservation dropped from passenger with panelty</li><li>response cost calculated to passenger and intiate payment charge to passenger</li><li>response cost calculated to driver and initiate payment to driver</li><li>store rating, comment, report into database. Trigger messages to coresponding party.</li></ul><p>Passenger-input: data that passenger receives</p><ul><li>ack of login and ready to pick driver</li><li>status of drivers around current location</li><li>auto-matched driver and related information about driver, car condition, price rate</li><li>confirmation of car reservation with driver‚Äôs info</li><li>trip route and estimated time</li><li>GPS tracking of car arriving or GPS tracking during the trip</li><li>notification of payment</li><li>notification of canceled trip</li><li>prompt to rate and comment</li><li>phone call from driver (extenal)</li></ul><p>Passenger-output: action that passenger takes</p><ul><li>create account</li><li>login</li><li>add payment information</li><li>put current location and destination location</li><li>select type of uber car, and start searching(matching)</li><li>accept/decline auto-matched driver</li><li>call driver (extenal)</li><li>cancel reservation</li><li>put comment, rating, or report to the system</li><li>automatically pay (be charged) of the trip cost from server</li></ul><p>Driver-input:</p><ul><li>ack of login and ready to start driving</li><li>auto-recommended passenger‚Äôs information: location, passenger rating</li><li>confirmation of reservation &amp;&amp; current waiting location</li><li>trip route and estimated time</li><li>GPS tracking of car arriving or GPS tracking during the trip</li><li>notification of payment</li><li>notification of trip cancelation from passenger</li><li>prompt to rate and comment passenger</li><li>phone call from passenger (extenal)</li><li>receive payment from server</li></ul><p>Driver-output:</p><ul><li>create account</li><li>login and set status avaialbe</li><li>add payment info</li><li>accept/decline recommended match</li><li>call passenger (extenal)</li><li>cancel reservation</li><li>put comment &amp;&amp; rating of passenger</li></ul></li></ol><ol start="4"><li><p>Summarize core features and tools to implement</p><ul><li>account management:</li><li>payment integration: paypal integration? some other credicar processing tools</li><li>matching algorithm: core problem to solve. Figure out the cheapest match for passenger, and time&amp;&amp;cost efficient match for driver. There might be lots of constraints to think about for the matching algorithm: cost&amp;&amp;time to pick up passenger around multiple driver, based on driver preference to filter type of trip (farest distance to travel)</li><li>trip process monitoring, notification: RESTful calls between server &amp;&amp; driver &amp;&amp; passenger.</li><li>GPS location tracking and route calculation: Google map?</li><li>trip cost calculation: calculated based on route length, trip time, rate at specific time, complains filed by passenger</li><li>rating &amp;&amp; comment system: RESTful post from driver/passenger</li></ul></li><li><p>Technologies potentially needed:<br>Tools:A server to handle RESTful calls, support live connection between nodes, handle trip matching algorithm, handle cost calculation.</p><ul><li>Node.js with expressJS: provide RESTful API</li><li>Socket.io for concurrent communication between server, user, driver in the same socket room.</li><li>Data storag: Sql or non-sql? Why? Later on, it seems easy to split data by region, so non-sql db seems okay to use.</li><li>Algorithm: How does heavy calculation handled on Nodejs? Should it be something to do with multi-threading?</li></ul></li><li><p>How does the system scale? What are the limits and trade-off in current design? What improvmenet can be done to design it differently?<br>First, assume everything is running based off one giant server: all conversations and calculation are handled via this server.<br>Second, the size of data might be too costly to search, calculate, and it‚Äôs not practical to store everything on one machine:</p><ul><li>user/driver account info might be too large</li><li>concurrent calculation for trip matching</li><li>number concurrent trip monitoring and conversation</li><li>concurrent calculation for trip cost<br>Therefore, it seems wiser to split onto multiple servers.<br>Third question: in which way to split the data? It seems we need to treat different type of data separately</li><li>For actively moving driver and user: we can store their location data dynamically by region. Once moved into/out of one regin, poll the information from one server into another server. Here, it‚Äôs wise to use HashTable to store as &lt;userID, everything about this user&gt;. Calculation algorithm may also happen on this server, because both driver &amp;&amp; passenger are on this server, defined by region.</li><li>Now we‚Äôve splitted data into servers by region. However, for same region, it might be too much work for one machine. We need to split data aross different machines for same region. Here, use another Hash lookup table to store<live tripid,="" server="">to split data into even smaller sections to fit in different server. Now we can have more <strong>regionServer</strong>.</live></li><li>A improvement that can be done: for relative static information account,payment,rating, they are only used once or twice during a trip. It might be okay to store these information on a type of server that specifically handles account look up, let‚Äôs call it <strong>accountServer</strong>. Again, there might be too much account info to store, we can build lookup tables to store &lt;accountID, serverID&gt;. Double again, do MapReduce to hash the keys so that we can split the look up table if the table is too big to store on one server.</li></ul></li></ol></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">------Êú¨ÊñáÁªìÊùü üñê ÊÑüË∞¢ÈòÖËØª------</div></div></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/system/" rel="tag"><i class="fa fa-tag"></i> system</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/linux-vim.html" rel="next" title="VimÂëΩ‰ª§ÂêàÈõÜ"><i class="fa fa-chevron-left"></i> VimÂëΩ‰ª§ÂêàÈõÜ</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/idea-remote-tomcat.html" rel="prev" title="‰ΩøÁî®IDEAËøúÁ®ãÈÉ®ÁΩ≤tomcatÂíåË∞ÉËØï">‰ΩøÁî®IDEAËøúÁ®ãÈÉ®ÁΩ≤tomcatÂíåË∞ÉËØï <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><script>window._bd_share_config={common:{bdText:"",bdMini:"1",bdMiniList:!1,bdPic:""},image:{viewList:["tsina","douban","sqq","qzone","weixin","twi","fbook"],viewText:"ÂàÜ‰∫´Âà∞Ôºö",viewSize:"16"},slide:{bdImg:"5",bdPos:"left",bdTop:"100"}}</script><script>with(document)(0)[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date/36e5)]</script></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">ÊñáÁ´†ÁõÆÂΩï</li><li class="sidebar-nav-overview" data-target="site-overview">Á´ôÁÇπÊ¶ÇËßà</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="https://i.loli.net/2017/12/28/5a45010eded15.jpg" alt="KronChan"><p class="site-author-name" itemprop="name">KronChan</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">192</span> <span class="site-state-item-name">Êó•Âøó</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">9</span> <span class="site-state-item-name">ÂàÜÁ±ª</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">74</span> <span class="site-state-item-name">Ê†áÁ≠æ</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS </a><a title="Êî∂ËóèÂà∞‰π¶Á≠æÔºåÂÅ∂Â∞îHigh‰∏Ä‰∏ã^_^" rel="alternate external nofollow" class="mw-harlem_shake_slow wobble shake" href="javascript:go()"><i class="fa fa-music"></i> Âê¨Èü≥‰πê</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/kaimz" target="_blank" title="GitHub" rel="external nofollow noopener noreferrer"><i class="fa fa-fw fa-github"></i> GitHub </a></span><span class="links-of-author-item"><a href="mailto:k@wuwii.com" target="_blank" title="Email" rel="external nofollow"><i class="fa fa-fw fa-envelope-o"></i> Email </a></span><span class="links-of-author-item"><a href="http://wpa.qq.com/msgrd?v=3&uin=1075199251&site=qq&menu=yes" target="_blank" title="QQ" rel="external nofollow noopener noreferrer"><i class="fa fa-fw fa-qq"></i> QQ</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://weispring.github.io/" title="ÊÇ¶Â§è" target="_blank" rel="external nofollow noopener noreferrer">ÊÇ¶Â§è</a></li><li class="links-of-blogroll-item"><a href="http://sdll.club" title="Èó™ÁîµÊãâÊãâ" target="_blank" rel="external nofollow noopener noreferrer">Èó™ÁîµÊãâÊãâ</a></li><li class="links-of-blogroll-item"><a href="https://www.draw.io/" title="draw.io" target="_blank" rel="external nofollow noopener noreferrer">draw.io</a></li><li class="links-of-blogroll-item"><a href="https://www.processon.com/" title="processon" target="_blank" rel="external nofollow noopener noreferrer">processon</a></li><li class="links-of-blogroll-item"><a href="http://asciiflow.com/" title="asciiflow" target="_blank" rel="external nofollow noopener noreferrer">asciiflow</a></li><li class="links-of-blogroll-item"><a href="http://hui-wang.info/" title="ÁéãËæâÁöÑÂçöÂÆ¢" target="_blank" rel="external nofollow noopener noreferrer">ÁéãËæâÁöÑÂçöÂÆ¢</a></li><li class="links-of-blogroll-item"><a href="https://leetcode.com/" title="leetcode" target="_blank" rel="external nofollow noopener noreferrer">leetcode</a></li><li class="links-of-blogroll-item"><a href="http://www.lintcode.com/" title="lintcode" target="_blank" rel="external nofollow noopener noreferrer">lintcode</a></li><li class="links-of-blogroll-item"><a href="https://stackoverflow.com/" title="stackoverflow" target="_blank" rel="external nofollow noopener noreferrer">stackoverflow</a></li><li class="links-of-blogroll-item"><a href="http://www.importnew.com/" title="ImportNew" target="_blank" rel="external nofollow noopener noreferrer">ImportNew</a></li><li class="links-of-blogroll-item"><a href="http://ifeve.com/" title="ifeve" target="_blank" rel="external nofollow noopener noreferrer">ifeve</a></li><li class="links-of-blogroll-item"><a href="http://blog.720ui.com/" title="Ê¢ÅÊ°ÇÈíäÁöÑÂçöÂÆ¢" target="_blank" rel="external nofollow noopener noreferrer">Ê¢ÅÊ°ÇÈíäÁöÑÂçöÂÆ¢</a></li><li class="links-of-blogroll-item"><a href="http://www.itmuch.com/" title="Spring Cloud|Âë®Á´ã" target="_blank" rel="external nofollow noopener noreferrer">Spring Cloud|Âë®Á´ã</a></li><li class="links-of-blogroll-item"><a href="https://edu.aliyun.com/" title="ÈòøÈáå‰∫ëÂ§ßÂ≠¶" target="_blank" rel="external nofollow noopener noreferrer">ÈòøÈáå‰∫ëÂ§ßÂ≠¶</a></li><li class="links-of-blogroll-item"><a href="http://www.iocoder.cn/" title="„ÄåËäãÈÅìÊ∫êÁ†Å„Äç" target="_blank" rel="external nofollow noopener noreferrer">„ÄåËäãÈÅìÊ∫êÁ†Å„Äç</a></li><li class="links-of-blogroll-item"><a href="http://cmsblogs.com" title="cmsblogs" target="_blank" rel="external nofollow noopener noreferrer">cmsblogs</a></li><li class="links-of-blogroll-item"><a href="http://36kr.com/" title="36Ê∞™" target="_blank" rel="external nofollow noopener noreferrer">36Ê∞™</a></li><li class="links-of-blogroll-item"><a href="https://laod.cn/" title="ËÄÅDÂçöÂÆ¢" target="_blank" rel="external nofollow noopener noreferrer">ËÄÅDÂçöÂÆ¢</a></li><li class="links-of-blogroll-item"><a href="http://blog.didispace.com/" title="Á®ãÂ∫èÁåøDD" target="_blank" rel="external nofollow noopener noreferrer">Á®ãÂ∫èÁåøDD</a></li><li class="links-of-blogroll-item"><a href="http://www.bijishequ.com/" title="Á¨îËÆ∞Á§æÂå∫" target="_blank" rel="external nofollow noopener noreferrer">Á¨îËÆ∞Á§æÂå∫</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Good-Concepts"><span class="nav-number">1.</span> <span class="nav-text">Good Concepts:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Steps"><span class="nav-number">2.</span> <span class="nav-text">Steps:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scalibility-lecture"><span class="nav-number">3.</span> <span class="nav-text">Scalibility lecture</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#URL-convention-Example-Final-http-www-hiredintech-com-system-design-final-thoughts"><span class="nav-number">3.1.</span> <span class="nav-text">URL convention Example Final (http://www.hiredintech.com/system-design/final-thoughts/)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Design-UBER"><span class="nav-number">4.</span> <span class="nav-text">Design UBER</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2017 - <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="powered-by" itemprop="copyrightHolder">KronChan</span> <span class="site-pv"><i class="fa fa-eye"></i> <span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div><div class="powered-by">Hosted by <a href="https://pages.coding.me" rel="external nofollow noopener noreferrer" target="_blank">Coding Pages</a></div><i class="fa fa-bar-chart"></i><div class="theme-info" style="margin-left:8px"><span class="post-count">Site words total count:350.2k</span></div><script type="text/javascript" src="https://zqnight.gitee.io/kaimz.github.io/js/high.js"></script><script>!function(){var t="http:"==document.location.protocol?"http://js.passport.qihucdn.com/11.0.1.js?f62559b2127396ecb27f4ed4f4652ea1":"https://jspassport.ssl.qhimg.com/11.0.1.js?f62559b2127396ecb27f4ed4f4652ea1";document.write('<script src="'+t+'" id="sozz"><\/script>')}()</script><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;w<0&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/44968c17.js","daovoice"),daovoice("init",{app_id:"44968c17"}),daovoice("update")</script><script type="text/javascript" src="https://zqnight.gitee.io/kaimz.github.io/js/clipboard.min.js"></script><script type="text/javascript" src="https://zqnight.gitee.io/kaimz.github.io/js/copy.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({model:{jsonPath:"/live2dw/assets/tororo.model.json"},display:{position:"left",width:100,height:200},mobile:{show:!1},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html><!-- rebuild by neat -->